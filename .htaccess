# Kirby .htaccess
# https://getkirby.com/docs/guide/urls

# Security headers
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options nosniff
  Header always set X-Frame-Options DENY
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Prevent access to sensitive files
<Files ~ "^\.">
  Order allow,deny
  Deny from all
</Files>

<Files ~ "\.(txt|md|yml|yaml|json|log|sql)$">
  Order allow,deny
  Deny from all
</Files>

# Deny access to sensitive directories
<Directory "kirby">
  Order allow,deny
  Deny from all
</Directory>

<Directory ".git">
  Order allow,deny
  Deny from all
</Directory>

# Deny access to site subdirectories (except public files)
<Directory "site/blueprints">
  Order allow,deny
  Deny from all
</Directory>

<Directory "site/config">
  Order allow,deny
  Deny from all
</Directory>

<Directory "site/accounts">
  Order allow,deny
  Deny from all
</Directory>

<Directory "site/sessions">
  Order allow,deny
  Deny from all
</Directory>

<Directory "site/cache">
  Order allow,deny
  Deny from all
</Directory>

<Directory "site/plugins">
  Order allow,deny
  Deny from all
</Directory>

# Rewrite rules for Kirby
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Redirect to www (optional - uncomment if needed)
  # RewriteCond %{HTTP_HOST} !^www\. [NC]
  # RewriteRule ^(.*)$ http://www.%{HTTP_HOST}/$1 [R=301,L]
  
  # Handle Kirby URLs
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*) index.php [QSA,L]
</IfModule>

# Security headers
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options nosniff
  Header always set X-Frame-Options DENY
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Prevent access to sensitive files
<Files ~ "^\.">
  Order allow,deny
  Deny from all
</Files>

<Files ~ "\.(txt|md|yml|yaml|json|log|sql)$">
  Order allow,deny
  Deny from all
</Files> 